{% extends "layout.html" %}

{% block title %}Tournament Statistics{% endblock %}

{% block content %}
    <div class="container">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <a href="{{ url_for('admin.manage_events') }}" class="btn btn-sm btn-outline-primary mb-2">
                    <i class="fas fa-arrow-left me-1"></i> Back to Events
                </a>
                <h1>
                    <i class="fas fa-medal text-primary me-2"></i>
                    {{ tournament_stats.tournament_name }} Statistics
                </h1>
            </div>
            <div>
                <a href="{{ url_for('admin_stats.edit_tournament_statistics', tournament_id=tournament_stats.id) }}"
                   class="btn btn-primary">
                    <i class="fas fa-edit me-1"></i> Edit Tournament Details
                </a>
                <a href="{{ url_for('admin_stats.add_tournament_match', tournament_id=tournament_stats.id) }}"
                   class="btn btn-success">
                    <i class="fas fa-plus me-1"></i> Add Match
                </a>
            </div>
        </div>

        <div class="row mb-4">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h3 class="mb-0"><i class="fas fa-trophy me-2"></i>Tournament Overview</h3>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="text-center mb-4">
                                    <div class="team-logo">
                                        <i class="fas fa-futbol"></i>
                                    </div>
                                    <h4>FC Mara</h4>
                                    <p class="text-muted">{{ tournament_stats.tournament_name }}</p>

                                    {% if tournament_stats.position %}
                                        <div class="mt-3">
                                            {% if tournament_stats.position == 1 %}
                                                <span class="badge bg-warning p-2"><i class="fas fa-trophy me-1"></i> Champions</span>
                                            {% elif tournament_stats.position == 2 %}
                                                <span class="badge bg-secondary p-2"><i class="fas fa-medal me-1"></i> Runners-up</span>
                                            {% elif tournament_stats.position == 3 %}
                                                <span class="badge bg-secondary p-2"><i class="fas fa-medal me-1"></i> Third Place</span>
                                            {% else %}
                                                <span class="badge bg-primary p-2">Position: {{ tournament_stats.position }}</span>
                                            {% endif %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-8">
                                <div class="row text-center">
                                    <div class="col-md-4 mb-3">
                                        <div class="card bg-light">
                                            <div class="card-body py-3">
                                                <h2 class="mb-0">{{ tournament_stats.matches_played }}</h2>
                                                <p class="text-muted mb-0">Matches Played</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <div class="card bg-light">
                                            <div class="card-body py-3">
                                                <h2 class="mb-0">{{ tournament_stats.wins }}</h2>
                                                <p class="text-muted mb-0">Wins</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <div class="card bg-light">
                                            <div class="card-body py-3">
                                                <h2 class="mb-0">{{ tournament_stats.draws }}</h2>
                                                <p class="text-muted mb-0">Draws</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <div class="card bg-light">
                                            <div class="card-body py-3">
                                                <h2 class="mb-0">{{ tournament_stats.losses }}</h2>
                                                <p class="text-muted mb-0">Losses</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <div class="card bg-light">
                                            <div class="card-body py-3">
                                                <h2 class="mb-0">{{ tournament_stats.goals_for }}</h2>
                                                <p class="text-muted mb-0">Goals For</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <div class="card bg-light">
                                            <div class="card-body py-3">
                                                <h2 class="mb-0">{{ tournament_stats.goals_against }}</h2>
                                                <p class="text-muted mb-0">Goals Against</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="card bg-light mt-2">
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-4">
                                                <small class="text-muted">Tournament:</small>
                                                <p class="mb-0">{{ tournament_stats.tournament_name }}</p>
                                            </div>
                                            <div class="col-md-4">
                                                <small class="text-muted">Location:</small>
                                                <p class="mb-0">{{ tournament_stats.location or 'N/A' }}</p>
                                            </div>
                                            <div class="col-md-4">
                                                <small class="text-muted">Dates:</small>
                                                <p class="mb-0">{{ tournament_stats.start_date.strftime('%d %b %Y') }}
                                                    - {{ tournament_stats.end_date.strftime('%d %b %Y') }}</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                        <h3 class="mb-0"><i class="fas fa-gamepad me-2"></i>Tournament Matches</h3>
                    </div>
                    <div class="card-body p-0">
                        {% if tournament_matches %}
                            <div class="table-responsive">
                                <table class="table table-striped table-hover mb-0">
                                    <thead class="table-dark">
                                    <tr>
                                        <th>Round</th>
                                        <th>Match</th>
                                        <th>Date</th>
                                        <th>Location</th>
                                        <th>Actions</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    {% for match in tournament_matches %}
                                        <tr>
                                            <td>
                                                <span class="badge bg-primary">{{ match.match_round }}</span>
                                            </td>
                                            <td>
                                                <div class="d-flex justify-content-between align-items-center">
                                                    <span class="{% if match.home_team == 'FC Mara' %}fw-bold{% endif %}">{{ match.home_team }}</span>
                                                    <div class="mx-2">
                                                        <span class="badge bg-light text-dark px-2">{{ match.home_score }} - {{ match.away_score }}</span>
                                                    </div>
                                                    <span class="{% if match.away_team == 'FC Mara' %}fw-bold{% endif %}">{{ match.away_team }}</span>
                                                </div>
                                            </td>
                                            <td>{{ match.match_date.strftime('%d %b %Y, %H:%M') }}</td>
                                            <td>{{ match.location or 'N/A' }}</td>
                                            <td>
                                                <div class="btn-group" role="group">
                                                    <a href="{{ url_for('admin_stats.edit_tournament_match', match_id=match.id) }}"
                                                       class="btn btn-sm btn-primary">
                                                        <i class="fas fa-edit"></i>
                                                    </a>
                                                    <a href="{{ url_for('admin_stats.add_tournament_player_performance', match_id=match.id) }}"
                                                       class="btn btn-sm btn-success">
                                                        <i class="fas fa-user-plus"></i>
                                                    </a>
                                                    <button type="button" class="btn btn-sm btn-danger"
                                                            data-bs-toggle="modal"
                                                            data-bs-target="#deleteMatchModal{{ match.id }}">
                                                        <i class="fas fa-trash-alt"></i>
                                                    </button>
                                                </div>

                                                <!-- Delete Confirmation Modal -->
                                                <div class="modal fade" id="deleteMatchModal{{ match.id }}"
                                                     tabindex="-1" aria-labelledby="deleteMatchModalLabel{{ match.id }}"
                                                     aria-hidden="true">
                                                    <div class="modal-dialog">
                                                        <div class="modal-content">
                                                            <div class="modal-header bg-danger text-white">
                                                                <h5 class="modal-title"
                                                                    id="deleteMatchModalLabel{{ match.id }}">
                                                                    <i class="fas fa-exclamation-triangle me-2"></i>Confirm
                                                                    Delete
                                                                </h5>
                                                                <button type="button" class="btn-close btn-close-white"
                                                                        data-bs-dismiss="modal"
                                                                        aria-label="Close"></button>
                                                            </div>
                                                            <div class="modal-body">
                                                                <p>Are you sure you want to delete the match:
                                                                    <strong>{{ match.home_team }}
                                                                        vs {{ match.away_team }}</strong>?</p>
                                                                <p class="mb-0 text-danger"><small>This action cannot be
                                                                    undone.</small></p>
                                                            </div>
                                                            <div class="modal-footer">
                                                                <button type="button" class="btn btn-secondary"
                                                                        data-bs-dismiss="modal">
                                                                    <i class="fas fa-times me-1"></i>Cancel
                                                                </button>
                                                                <form action="{{ url_for('admin_stats.delete_tournament_match', match_id=match.id) }}"
                                                                      method="POST">
                                                                    <button type="submit" class="btn btn-danger">
                                                                        <i class="fas fa-trash-alt me-1"></i>Delete
                                                                    </button>
                                                                </form>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                    {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        {% else %}
                            <div class="alert alert-info m-3">
                                <div class="d-flex">
                                    <div class="me-3">
                                        <i class="fas fa-info-circle fa-2x"></i>
                                    </div>
                                    <div>
                                        <h5 class="alert-heading">No Tournament Matches</h5>
                                        <p class="mb-0">No matches have been added for this tournament yet. Click the
                                            "Add Match" button to add your first match.</p>
                                    </div>
                                </div>
                            </div>
                        {% endif %}
                    </div>
                    <div class="card-footer">
                        <a href="{{ url_for('admin_stats.add_tournament_match', tournament_id=tournament_stats.id) }}"
                           class="btn btn-success">
                            <i class="fas fa-plus me-1"></i> Add Tournament Match
                        </a>
                    </div>
                </div>
            </div>
        </div>

        {% if tournament_stats.notes %}
            <div class="row mt-3">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-header bg-light">
                            <h3 class="mb-0"><i class="fas fa-sticky-note me-2"></i>Tournament Notes</h3>
                        </div>
                        <div class="card-body">
                            <p>{{ tournament_stats.notes }}</p>
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}
    </div>
{% endblock %}