{% extends "base.html" %}

{% block title %}Team Statistics - Football Team Management{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1>Team Statistics</h1>
    {% if current_user.is_authenticated and current_user.is_admin() %}
    <div>
        <a href="{{ url_for('statistics.create_team_stat') }}" class="btn btn-primary">
            <i class="fas fa-plus me-1"></i>Add Team Stats
        </a>
    </div>
    {% endif %}
</div>

<div class="card mb-4">
    <div class="card-header">
        <ul class="nav nav-pills card-header-tabs">
            {% for season_item in seasons %}
                <li class="nav-item">
                    <a class="nav-link {% if season_item[0] == current_season %}active{% endif %}"
                       href="{{ url_for('statistics.team', season=season_item[0]) }}">
                        {{ season_item[0] }}
                    </a>
                </li>
            {% endfor %}
        </ul>
    </div>
    <div class="card-body">
        {% if team_stats %}
            <div class="row mb-4">
                <div class="col-md-6">
                    <h4 class="mb-3">Season Overview: {{ team_stats.season }}</h4>
                    <div class="row">
                        <div class="col-md-4 col-sm-4 mb-3">
                            <div class="stat-card bg-success text-white">
                                <h2>{{ team_stats.wins }}</h2>
                                <p class="mb-0">Wins</p>
                            </div>
                        </div>
                        <div class="col-md-4 col-sm-4 mb-3">
                            <div class="stat-card bg-danger text-white">
                                <h2>{{ team_stats.losses }}</h2>
                                <p class="mb-0">Losses</p>
                            </div>
                        </div>
                        <div class="col-md-4 col-sm-4 mb-3">
                            <div class="stat-card bg-secondary text-white">
                                <h2>{{ team_stats.draws }}</h2>
                                <p class="mb-0">Draws</p>
                            </div>
                        </div>
                    </div>

                    <div class="card mt-3">
                        <div class="card-body">
                            <h5 class="card-title">Season Results</h5>
                            <div class="progress" style="height: 30px;">
                                {% set total_games = team_stats.wins + team_stats.losses + team_stats.draws %}
                                {% if total_games > 0 %}
                                    {% set win_percentage = (team_stats.wins / total_games * 100)|round %}
                                    {% set draw_percentage = (team_stats.draws / total_games * 100)|round %}
                                    {% set loss_percentage = (team_stats.losses / total_games * 100)|round %}

                                    <div class="progress-bar bg-success" role="progressbar" style="width: {{ win_percentage }}%"
                                         aria-valuenow="{{ win_percentage }}" aria-valuemin="0" aria-valuemax="100">
                                        {{ win_percentage }}% Wins
                                    </div>
                                    <div class="progress-bar bg-secondary" role="progressbar" style="width: {{ draw_percentage }}%"
                                         aria-valuenow="{{ draw_percentage }}" aria-valuemin="0" aria-valuemax="100">
                                        {{ draw_percentage }}% Draws
                                    </div>
                                    <div class="progress-bar bg-danger" role="progressbar" style="width: {{ loss_percentage }}%"
                                         aria-valuenow="{{ loss_percentage }}" aria-valuemin="0" aria-valuemax="100">
                                        {{ loss_percentage }}% Losses
                                    </div>
                                {% else %}
                                    <div class="progress-bar" role="progressbar" style="width: 100%" aria-valuenow="100"
                                         aria-valuemin="0" aria-valuemax="100">No games played</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-md-6">
                    <h4 class="mb-3">Performance Metrics</h4>
                    <div class="row">
                        <div class="col-md-4 col-sm-4 mb-3">
                            <div class="stat-card bg-info text-white">
                                <h2>{{ team_stats.goals_scored }}</h2>
                                <p class="mb-0">Goals Scored</p>
                            </div>
                        </div>
                        <div class="col-md-4 col-sm-4 mb-3">
                            <div class="stat-card bg-warning text-dark">
                                <h2>{{ team_stats.goals_conceded }}</h2>
                                <p class="mb-0">Goals Conceded</p>
                            </div>
                        </div>
                        <div class="col-md-4 col-sm-4 mb-3">
                            <div class="stat-card bg-light">
                                <h2>{{ team_stats.clean_sheets }}</h2>
                                <p class="mb-0">Clean Sheets</p>
                            </div>
                        </div>
                    </div>

                    <div class="card mt-3">
                        <div class="card-body">
                            <h5 class="card-title">League Position</h5>
                            <div class="d-flex align-items-center">
                                <div class="display-4 me-3">{{ team_stats.league_position|ordinal }}</div>
                                <div>
                                    {% if team_stats.league_position <= 3 %}
                                        <span class="badge bg-success">Top 3 Finish</span>
                                    {% elif team_stats.league_position <= 6 %}
                                        <span class="badge bg-info">Top 6 Finish</span>
                                    {% elif team_stats.league_position <= 10 %}
                                        <span class="badge bg-primary">Mid-table</span>
                                    {% elif team_stats.league_position <= 17 %}
                                        <span class="badge bg-warning">Lower Half</span>
                                    {% else %}
                                        <span class="badge bg-danger">Relegation Zone</span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            {% if current_user.is_authenticated and current_user.is_admin() %}
            <div class="d-flex justify-content-end">
                <a href="{{ url_for('statistics.update_team_stat', stat_id=team_stats.id) }}" class="btn btn-outline-primary me-2">
                    <i class="fas fa-edit me-1"></i>Edit Stats
                </a>
                <form action="{{ url_for('statistics.delete_team_stat', stat_id=team_stats.id) }}" method="POST" onsubmit="return confirm('Are you sure you want to delete these statistics?')">
                    <button type="submit" class="btn btn-outline-danger">
                        <i class="fas fa-trash-alt me-1"></i>Delete Stats
                    </button>
                </form>
            </div>
            {% endif %}
        {% else %}
            <div class="alert alert-info">
                <i class="fas fa-info-circle me-2"></i>No team statistics available for this season.
                {% if current_user.is_authenticated and current_user.is_admin() %}
                <a href="{{ url_for('statistics.create_team_stat') }}" class="alert-link">Add team statistics</a>
                {% endif %}
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}