{% extends "base.html" %}

{% block title %}Trophy Cabinet - FC Mara{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1><i class="fas fa-trophy me-2 text-warning"></i>Trophy Cabinet</h1>
    {% if current_user.is_authenticated and current_user.is_admin() %}
    <div>
        <a href="{{ url_for('trophies.create') }}" class="btn btn-primary">
            <i class="fas fa-plus me-1"></i>Add Trophy
        </a>
    </div>
    {% endif %}
</div>

{% if trophies_by_year %}
    {% for year, trophies in trophies_by_year.items() %}
        <div class="card mb-4 border-0 shadow-sm">
            <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                <h5 class="mb-0"><i class="fas fa-calendar-alt me-2"></i>{{ year }}</h5>
                <span class="badge bg-light text-primary">{{ trophies|length }} trophies</span>
            </div>
            <div class="card-body">
                <div class="row">
                    {% for trophy in trophies %}
                        <div class="col-lg-4 col-md-6 mb-4">
                            <div class="card h-100 trophy-card border-0 shadow-sm">
                                <div class="text-center p-4">
                                    <img src="{{ url_for('static', filename='uploads/trophies/' + trophy.image) }}"
                                         alt="{{ trophy.name }}"
                                         class="img-fluid trophy-image"
                                         style="max-height: 180px;">
                                </div>
                                <div class="card-body text-center pb-4">
                                    <div class="badge bg-primary mb-2 px-3 py-2">{{ trophy.competition }}</div>
                                    <h5 class="card-title fw-bold">{{ trophy.name }}</h5>
                                    <p class="card-text mb-4">{{ trophy.description|truncate(100) }}</p>
                                    <a href="{{ url_for('trophies.detail', trophy_id=trophy.id) }}" class="btn btn-outline-primary">
                                        <i class="fas fa-eye me-1"></i>View Details
                                    </a>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    {% endfor %}
{% else %}
    <div class="text-center py-5 card shadow-sm">
        <div class="card-body py-5">
            <i class="fas fa-trophy text-muted fa-5x mb-4"></i>
            <h3 class="text-muted">No trophies in the cabinet yet</h3>
            <p class="text-muted">Trophies will be displayed here once they are added.</p>
            {% if current_user.is_authenticated and current_user.is_admin() %}
                <a href="{{ url_for('trophies.create') }}" class="btn btn-primary mt-3">
                    <i class="fas fa-plus me-1"></i>Add First Trophy
                </a>
            {% endif %}
        </div>
    </div>
{% endif %}

<div class="card mt-5 bg-primary text-white border-0 shadow">
    <div class="card-body p-0">
        <div class="row g-0">
            <div class="col-md-6 p-4 p-md-5">
                <h3 class="fw-bold">FC Mara's Legacy</h3>
                <p class="lead">Our trophy cabinet showcases the team's achievements throughout the years.</p>
                <p>Each trophy represents countless hours of dedication, teamwork, and perseverance from players, coaches, and staff.</p>
                <a href="#" class="btn btn-light mt-3">
                    <i class="fas fa-history me-1"></i>Team History
                </a>
            </div>
            <div class="col-md-6 bg-white text-dark p-4 p-md-5">
                <h4 class="fw-bold mb-4">Trophy Statistics</h4>
                <div class="row">
                    <div class="col-6 mb-4">
                        <div class="card bg-light">
                            <div class="card-body text-center p-3">
                                <h2 class="fw-bold text-primary">{{ trophies_by_year.keys()|list|length }}</h2>
                                <p class="text-muted mb-0">Winning Years</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-6 mb-4">
                        <div class="card bg-light">
                            <div class="card-body text-center p-3">
                                <h2 class="fw-bold text-primary">{{ trophies_by_year.values()|sum(attribute='__len__') }}</h2>
                                <p class="text-muted mb-0">Total Trophies</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="d-flex align-items-center mb-3">
                    <div class="flex-shrink-0 me-3">
                        <div class="bg-warning text-white rounded-circle p-2" style="width: 40px; height: 40px; display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-medal"></i>
                        </div>
                    </div>
                    <div>
                        <h6 class="fw-bold mb-0">Most Successful Year</h6>
                        {% set most_trophies_year = trophies_by_year|dictsort(by='value', reverse=true)|first %}
                        <p class="mb-0">{{ most_trophies_year[0] }} ({{ most_trophies_year[1]|length }} trophies)</p>
                    </div>
                </div>
                <div class="d-flex align-items-center">
                    <div class="flex-shrink-0 me-3">
                        <div class="bg-info text-white rounded-circle p-2" style="width: 40px; height: 40px; display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-award"></i>
                        </div>
                    </div>
                    <div>
                        <h6 class="fw-bold mb-0">Latest Achievement</h6>
                        {% set latest_year = trophies_by_year.keys()|list|first %}
                        <p class="mb-0">{{ latest_year }} Season</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}